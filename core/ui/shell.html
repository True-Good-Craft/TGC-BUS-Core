<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>BUS Core</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/svg+xml" href="favicon.svg?v=buscore-8">
  <link rel="stylesheet" href="/ui/css/app.css">
  <style>
    :root { --bg:#1a1a1a; --fg:#eee; --accent:#0a84ff; --sidebar:#222; }
    *{box-sizing:border-box}
    body{margin:0;font:14px/1.5 system-ui,Segoe UI,Arial;background:var(--bg);color:var(--fg);display:flex;height:100vh}
    #sidebar{width:200px;background:var(--sidebar);padding:16px 0;border-right:1px solid #333}
    #sidebar h1{margin:0 0 16px 16px;font-size:14px;color:#aaa}
    .tab{padding:10px 16px;cursor:pointer;border-left:4px solid transparent}
    .tab.active{background:#333;border-left-color:var(--accent);font-weight:600}
    .tab:hover:not(.active){background:#2a2a2a}
    .nav-group{display:flex;flex-direction:column;padding-left:16px;gap:4px;margin-top:4px}
    .nav-group .nav-item{padding:8px 16px;border-left:4px solid transparent;color:inherit;text-decoration:none;display:block;border-radius:4px}
    .nav-group .nav-item:hover{background:#2a2a2a}
    .nav-group .nav-item.nav-subitem{font-size:13px;color:#ccc}
    #main{flex:1;padding:20px;overflow:auto}
    .card{background:#242424;padding:16px;border-radius:8px;margin-bottom:16px}
    .card h2{margin:0 0 8px;color:var(--accent)}
    button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    button:hover{opacity:.9}
    pre{background:#111;padding:12px;border-radius:6px;overflow:auto;font-size:12px}
    .hidden{display:none!important}
    .brand-inline{display:flex;align-items:center}
    .tabs{display:flex;gap:8px;margin-bottom:16px}
    .tabs button{background:#2b2f36;color:#e6e6e6;border:1px solid #363b44;padding:8px 14px;border-radius:10px;cursor:pointer}
    .tabs button.active{background:var(--accent);border-color:var(--accent);color:#fff}
    .tab-panel{display:flex;flex-direction:column;gap:16px}
    .modal.hidden{display:none}
    .modal.open{display:flex}
    .modal .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.5)}
    .modal .modal-dialog{position:relative;z-index:1}
    .drawer{position:fixed;inset:0;display:flex;justify-content:flex-end;pointer-events:none;z-index:60;transition:visibility 0s linear .3s}
    .drawer.hidden{visibility:hidden}
    .drawer:not(.hidden){pointer-events:auto;visibility:visible;transition-delay:0s}
    .drawer .drawer-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.6);opacity:1;transition:opacity .3s ease}
    .drawer.hidden .drawer-backdrop{opacity:0}
    .drawer-panel{position:relative;width:360px;max-width:90vw;background:#1f2126;color:#e6e6e6;box-shadow:-4px 0 16px rgba(0,0,0,0.4);transform:translateX(0);transition:transform .3s ease;display:flex;flex-direction:column}
    .drawer.hidden .drawer-panel{transform:translateX(100%)}
    .drawer-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid #2c2f36}
    .drawer-body{padding:16px;overflow-y:auto;max-height:calc(100vh - 64px);display:flex;flex-direction:column;gap:12px}
    .drawer-body .kv{display:flex;justify-content:space-between;gap:12px;font-size:13px;background:#23262b;padding:8px 12px;border-radius:8px}
    .drawer-body .kv .k{color:#9ca3af;text-transform:uppercase;font-size:11px}
    .drawer-body .kv .v{color:#e6e6e6;word-break:break-word}
    .drawer-body .mt{margin:16px 0 4px;font-size:14px;color:#cbd5f5}
    .drawer-body .list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:6px}
    .drawer-body .list li{background:#23262b;padding:8px 12px;border-radius:8px;font-size:13px}
    .small-dot-icon{display:inline-block;width:6px;height:6px;border-radius:50%;background:#ff7a00;vertical-align:middle;margin:0 6px 0 2px}
    .app-logo{height:28px;width:auto;vertical-align:middle;margin-right:8px}
    .brand-nav{
      height:16px;
      width:auto;
      vertical-align:middle;
      margin:0 8px 0 6px;
      object-fit:contain;
      image-rendering:auto;
    }
    @media (min-width:1280px){.brand-nav{height:18px}}
    .hero-logo{max-width:420px;width:100%;height:auto;display:block;margin:16px auto}
    @media (max-width:480px){.app-logo{height:24px;margin-right:6px}}
    /* === Sidebar primary nav: centered with safe insets === */
    #sidebar .nav,
    #sidebar .sidebar-nav{ list-style:none; margin:0; padding:0; }
    #sidebar .nav > li > a,
    #sidebar .sidebar-nav > li > a{
      display:block;
      text-align:center;     /* center the link text */
      padding:8px 12px;      /* internal buffer */
      margin:0 10px;         /* inset from left/right panel edges */
      border-radius:8px;
      text-decoration:none;
      color:inherit;
    }
    #sidebar .nav > li > a:hover,
    #sidebar .nav > li > a.active,
    #sidebar .sidebar-nav > li > a:hover,
    #sidebar .sidebar-nav > li > a.active{
      background:#2a2a2a;
    }
    /* Submenu links keep a slight indent but get touch-friendly padding */
    #sidebar .nav-group a{
      display:block;
      padding:6px 10px;
      border-radius:6px;
      text-decoration:none;
      color:inherit;
    }
    #sidebar .nav-group a:hover{ background:#2a2a2a; }
    /* === Sidebar submenu items centered === */
    #sidebar .nav-group { padding-left: 0; }
    #sidebar .nav-group li { list-style: none; }
    #sidebar .nav-group a {
      display: block;
      text-align: center;
      padding: 6px 10px;
      margin: 0 10px;
      border-radius: 6px;
      text-decoration: none;
      color: inherit;
    }
    #sidebar .nav-group a:hover { background: #2a2a2a; }
  </style>
  <script>
  (function(){
    const href = "favicon.svg?v=buscore-8";
    let link = document.querySelector('link[rel="icon"]');
    if(!link){ link=document.createElement('link'); link.rel='icon'; document.head.appendChild(link); }
    link.type = 'image/svg+xml'; link.href = href;
    document.querySelectorAll('link[rel="shortcut icon"],link[rel="apple-touch-icon"],link[rel="mask-icon"]').forEach(x=>x.remove());
  })();
  </script>
</head>
<body>
  <nav id="sidebar" class="sidebar">
    <div class="brand">
      <!-- Top-left brand -->
      <a class="tgc-brand" href="#/home" aria-label="Go to Dashboard/Home">
        <span class="tgc-brand-title">BUS Core</span>
        <span class="tgc-brand-beta">BETA</span>
        <span class="tgc-version" data-role="ui-version" style="margin-left:6px;opacity:.8;font-variant-numeric:tabular-nums"></span>
      </a>
    </div>
    <ul class="sidebar-nav">
      <li><a class="nav-link" href="#/home" data-role="nav-link" data-route="home">Dashboard</a></li>
      <li><a class="nav-link" href="#/inventory" data-role="nav-link" data-route="inventory">Items</a></li>
      <li><a class="nav-link" href="#/contacts" data-role="nav-link" data-route="contacts">Vendors</a></li>
      <li><a class="nav-link" href="#/recipes" data-role="nav-link" data-route="recipes">Recipes</a></li>
      <li><a class="nav-link" href="#/manufacturing" data-role="nav-link" data-route="manufacturing">Runs</a></li>
      <li><a class="nav-link" href="#/logs" id="nav-logs" data-role="nav-link" data-route="logs">Logs</a></li>
      <li><a class="nav-link" href="#/finance" data-role="nav-link" data-route="finance">Finance</a></li>
      <li><a class="nav-link" href="#/settings" id="nav-settings" data-role="nav-link" data-route="settings">Settings</a></li>
    </ul>
  </nav>
  <main id="main">
    <div id="app">
      <section data-role="home-screen" class="hidden"></section>
      <section data-role="inventory-screen" class="hidden"></section>
      <section data-role="contacts-screen" class="hidden"></section>
      <section data-role="recipes-screen" class="hidden"></section>
      <section data-role="manufacturing-screen" class="hidden"></section>
      <section data-role="logs-screen" class="hidden"></section>
      <section data-role="finance-screen" class="hidden"></section>
      <section data-role="settings-screen" class="hidden"></section>
    </div>
  </main>

  <aside data-role="contacts-drawer" class="drawer hidden" aria-hidden="true" role="dialog" aria-labelledby="contact-drawer-title">
    <div class="drawer-backdrop" data-action="close-contacts-drawer"></div>
    <div class="drawer-panel">
      <header class="drawer-header">
        <h3 id="contact-drawer-title" style="margin:0;font-size:18px;color:#f8fafc">Contact</h3>
        <button type="button" data-action="close-contacts-drawer" aria-label="Close" style="background:transparent;border:none;color:#9ca3af;font-size:24px;cursor:pointer;line-height:1">×</button>
      </header>
      <section class="drawer-body">
        <div class="kv"><span class="k">Type</span><span class="v" data-field="type"></span></div>
        <div class="kv"><span class="k">Name</span><span class="v" data-field="name"></span></div>
        <div class="kv"><span class="k">Email</span><span class="v" data-field="email"></span></div>
        <div class="kv vendor-only"><span class="k">Material</span><span class="v" data-field="material"></span></div>
        <div class="kv"><span class="k">Lead time (days)</span><span class="v" data-field="lead_time_days"></span></div>
        <div class="kv"><span class="k">Notes</span><span class="v" data-field="notes"></span></div>

        <h4 class="mt">Linked items</h4>
        <ul data-role="linked-items" class="list"><!-- populated by vendors.js --></ul>
      </section>
    </div>
  </aside>

  <div id="contacts-modal"
       data-role="contacts-modal"
       role="dialog"
       aria-modal="true"
       aria-labelledby="contacts-modal-title"
       class="modal hidden">
    <div class="modal-backdrop" aria-hidden="true"></div>
    <div class="modal-dialog modal-content">
      <header class="modal-header">
        <h2 id="contacts-modal-title">Add Contact</h2>
        <button type="button" data-action="close-contacts-modal" aria-label="Close">×</button>
      </header>

      <form data-role="contacts-form" class="modal-body">
        <div class="field">
          <label for="contact-name">Name</label>
          <input id="contact-name" name="name" type="text" required />
        </div>

        <div class="field">
          <label for="contact-type">Type</label>
          <select id="contact-type" name="type" required>
            <option value="">— Select —</option>
            <option value="vendor">Vendor</option>
            <option value="customer">Customer</option>
          </select>
        </div>

        <div class="field">
          <label for="contact-email">Email</label>
          <input id="contact-email" name="email" type="email" />
        </div>

        <div class="field" data-visible-when="vendor">
          <label for="contact-material">Material</label>
          <input id="contact-material" name="material" type="text" />
        </div>

        <div class="field">
          <label for="contact-leadtime">Lead time (days)</label>
          <input id="contact-leadtime" name="lead_time_days" type="number" inputmode="numeric" />
        </div>

        <div class="field">
          <label for="contact-notes">Notes</label>
          <textarea id="contact-notes" name="notes"></textarea>
        </div>

        <footer class="modal-footer">
          <button type="button" data-action="close-contacts-modal">Cancel</button>
          <button type="submit" data-role="contacts-save">Save</button>
        </footer>
      </form>
    </div>
  </div>

  <script type="module" src="/ui/app.js?v=invalidqtydebug2"></script>
</body>
</html>
